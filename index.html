<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YiHaoCar | å°ˆå±¬åº§é§•æ´¾é£ç³»çµ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0056b3;
            --primary-light: #eef6ff;
            --line-green: #00b900;
            --text-dark: #1a202c;
            --glass-bg: rgba(255, 255, 255, 0.98);
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #cfdef3 0%, #e0eafc 100%);
            background-attachment: fixed;
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 10px;
            box-sizing: border-box;
        }

        .main-card {
            background: var(--glass-bg);
            width: 100%;
            max-width: 550px;
            padding: 20px 15px;
            border-radius: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            align-self: flex-start;
        }

        .brand-zone { text-align: center; margin-bottom: 15px; }
        .brand-logo { font-size: 28px; font-weight: 900; color: var(--primary); margin: 0; }
        .brand-tagline { font-size: 11px; font-weight: 700; color: #a0aec0; letter-spacing: 2px; }

        .form-group { margin-bottom: 12px; position: relative; }
        .form-label { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 700; margin-bottom: 5px; color: #4a5568; }

        .input-box {
            width: 100%; padding: 12px; padding-right: 75px; 
            border: 2px solid #edf2f7; border-radius: 12px; font-size: 14px;
            background: #f8fafc; box-sizing: border-box; transition: 0.3s;
        }

        .input-box:focus { border-color: var(--primary); background: #fff; outline: none; }

        .btn-location {
            position: absolute; right: 8px; bottom: 5px; padding: 6px 10px;
            background: var(--primary-light); color: var(--primary);
            border: none; border-radius: 8px; font-size: 11px; font-weight: 700; cursor: pointer;
        }

        /* åœ°åœ–å€å¡Š - é è¨­é¡¯ç¤º */
        #map {
            width: 100%;
            height: 280px; 
            border-radius: 18px;
            margin: 15px 0;
            border: 1px solid #e2e8f0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        .options-row { display: flex; gap: 8px; margin-bottom: 15px; }
        .opt-btn {
            flex: 1; background: #f8fafc; border: 1.5px solid #edf2f7;
            padding: 8px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 12px;
            cursor: pointer;
        }
        .opt-btn input { margin-right: 5px; }

        .btn-calculate {
            width: 100%; background: var(--primary); color: white; padding: 15px;
            font-size: 16px; font-weight: 700; border: none; border-radius: 14px; cursor: pointer;
            transition: 0.3s;
        }
        .btn-calculate:hover { background: #004494; transform: translateY(-1px); }

        .result-panel {
            margin-top: 15px; padding: 18px; border-radius: 18px;
            background: #f1f7ff; border: 1px solid #e1e9f5; display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .result-price { font-size: 30px; font-weight: 900; color: var(--primary); margin: 5px 0; }

        .btn-line {
            width: 100%; background: var(--line-green); color: white; padding: 14px;
            font-size: 16px; font-weight: 700; border: none; border-radius: 12px;
            margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer;
        }

        .disclaimer { font-size: 10px; color: #a0aec0; text-align: center; margin-top: 15px; }
    </style>
</head>
<body>

<div class="main-card">
    <div class="brand-zone">
        <h1 class="brand-logo">YiHaoCar</h1>
        <div class="brand-tagline">å°ˆå±¬åº§é§•æ´¾é£ | æ™ºæ…§è¦åŠƒç³»çµ±</div>
    </div>

    <div class="form-group">
        <label class="form-label">ğŸ“ ä¹˜è»Šèµ·é»</label>
        <input type="text" id="start" class="input-box" placeholder="è«‹è¼¸å…¥èµ·é»">
        <button class="btn-location" onclick="getCurrentLocation()">ğŸ“ å®šä½</button>
    </div>

    <div class="form-group">
        <label class="form-label">ğŸ ä¹˜è»Šçµ‚é»</label>
        <input type="text" id="end" class="input-box" placeholder="è«‹è¼¸å…¥ç›®çš„åœ°">
    </div>

    <div id="map"></div>

    <div class="options-row">
        <label class="opt-btn"><input type="checkbox" id="avoidHighways"> é¿é–‹é«˜é€Ÿ</label>
        <label class="opt-btn"><input type="checkbox" id="avoidTolls"> é¿é–‹æ”¶è²»</label>
    </div>

    <button id="calc-btn" class="btn-calculate" onclick="calculateFare()">é–‹å§‹è©¦ç®—è»Šè³‡</button>

    <div id="result" class="result-panel">
        <div style="font-size:12px; color:#718096; font-weight:700;">é ä¼°è¡Œç¨‹ç¸½é‡‘é¡</div>
        <div id="price-tag" class="result-price">$0</div>
        <div id="info-tag" style="font-size:13px; white-space: pre-line; color:#4a5568; line-height:1.5;"></div>
        <button class="btn-line" onclick="copyAndLine()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" width="18" alt="LINE"> è¤‡è£½è¡Œç¨‹ä¸¦é ç´„
        </button>
    </div>

    <div class="disclaimer">
        â€» è©¦ç®—çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›è²»ç”¨ä¾å¸æ©Ÿå ±åƒ¹ç‚ºæº–ã€‚<br>
        è¨ˆè²»ï¼šèµ·æ­¥ $80 / é‡Œç¨‹ $15km / æ™‚é–“ $3min
    </div>
</div>

<script>
    let map, autocompleteStart, autocompleteEnd;
    let directionsService, directionsRenderer;

    function initMap() {
        // åˆå§‹åŒ– Directions æœå‹™
        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer({
            polylineOptions: { strokeColor: "#0056b3", strokeWeight: 6 },
            map: null 
        });

        // åˆå§‹åŒ–åœ°åœ–ï¼Œé è¨­ä¸­å¿ƒè¨­åœ¨å°ç£
        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 12,
            center: { lat: 24.1477, lng: 120.6736 }, // é è¨­å°ä¸­ï¼Œå¯ä¾éœ€æ±‚èª¿æ•´
            disableDefaultUI: false,
            mapTypeControl: false,
            streetViewControl: false,
            fullscreenControl: false
        });

        directionsRenderer.setMap(map);

        // åˆå§‹åŒ–è‡ªå‹•å®Œæˆè¼¸å…¥
        const options = { componentRestrictions: { country: "tw" } };
        autocompleteStart = new google.maps.places.Autocomplete(document.getElementById('start'), options);
        autocompleteEnd = new google.maps.places.Autocomplete(document.getElementById('end'), options);

        // ç•¶ä½¿ç”¨è€…é¸å®šåœ°å€å¾Œï¼Œåœ°åœ–è‡ªå‹•ç§»å‹•åˆ°è©²é»ï¼ˆé¸æ“‡æ€§å„ªåŒ–ï¼‰
        autocompleteStart.addListener('place_changed', () => {
            const place = autocompleteStart.getPlace();
            if (place.geometry) map.panTo(place.geometry.location);
        });
    }

    function calculateFare() {
        const start = document.getElementById('start').value;
        const end = document.getElementById('end').value;
        const hwy = document.getElementById('avoidHighways').checked;
        const toll = document.getElementById('avoidTolls').checked;

        if (!start || !end) return alert('è«‹å®Œæ•´å¡«å¯«èµ·è¨–é»');

        directionsService.route({
            origin: start,
            destination: end,
            travelMode: 'DRIVING',
            avoidHighways: hwy,
            avoidTolls: toll
        }, (result, status) => {
            if (status == 'OK') {
                directionsRenderer.setDirections(result);
                
                const leg = result.routes[0].legs[0];
                const dist = leg.distance.value / 1000;
                const time = Math.ceil(leg.duration.value / 60);
                
                // YiHaoCar è¨ˆç®—é‚è¼¯
                const total = Math.round(80 + (dist * 15) + (time * 3) + (dist > 15 ? (dist-15)*10 : 0));

                document.getElementById('price-tag').innerText = `$${total.toLocaleString()}`;
                document.getElementById('info-tag').innerText = `é‡Œç¨‹ï¼š${dist.toFixed(1)} km | è»Šç¨‹ï¼š${time} åˆ†é˜\n${hwy ? 'ã€é¿é–‹é«˜é€Ÿã€‘' : ''} ${toll ? 'ã€é¿é–‹æ”¶è²»ã€‘' : ''}`;
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('è¦åŠƒå¤±æ•—ï¼Œè«‹ç¢ºèªåœ°å€ç²¾ç¢ºåº¦');
            }
        });
    }

    function getCurrentLocation() {
        const btn = document.querySelector('.btn-location');
        if (!navigator.geolocation) return alert('ä¸æ”¯æ´å®šä½');
        btn.innerText = 'è®€å–ä¸­';
        navigator.geolocation.getCurrentPosition((pos) => {
            const latlng = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            new google.maps.Geocoder().geocode({ location: latlng }, (res, status) => {
                btn.innerText = 'ğŸ“ å®šä½';
                if (status === "OK") {
                    const addr = res[0].formatted_address.replace('å°ç£', '').trim();
                    document.getElementById('start').value = addr;
                    map.setCenter(latlng);
                    map.setZoom(15);
                }
            });
        }, () => { btn.innerText = 'ğŸ“ å®šä½'; alert('å®šä½å¤±æ•—'); }, { enableHighAccuracy: true });
    }

    function copyAndLine() {
        const start = document.getElementById('start').value;
        const end = document.getElementById('end').value;
        const price = document.getElementById('price-tag').innerText;
        const info = document.getElementById('info-tag').innerText;
        const msg = `ã€YiHaoCar è¡Œç¨‹é ç´„ã€‘\nğŸ“ èµ·é»ï¼š${start}\nğŸ çµ‚é»ï¼š${end}\nğŸ“Š ${info.replace(/\n/g, ' ')}\nğŸ’µ é ä¼°ç¸½è»Šè³‡ï¼š${price}`;
        
        navigator.clipboard.writeText(msg).then(() => {
            alert('è¡Œç¨‹å·²è¤‡è£½ï¼Œè«‹è‡³ LINE è²¼ä¸Šé ç´„');
            window.location.href = "https://lin.ee/o8sVnUW";
        });
    }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtgKupEUkOqUXV5bQMx_5PlXofFu-0vO4&libraries=places&callback=initMap&language=zh-TW" async defer></script>

</body>
</html>
