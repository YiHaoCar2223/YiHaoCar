<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YiHaoCar | å°Šæ¦®åº§é§•æ´¾é£ç³»çµ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-light: #f4f7f9;
            --main-blue: #002d5e;
            --accent-silver: #718096;
            --pure-white: #ffffff;
            --shadow-color: rgba(0, 45, 94, 0.08);
            --line-green: #06c755;
            --gold: #b45309;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-light);
            margin: 0; padding: 15px; min-height: 100vh;
            display: flex; justify-content: center;
            color: #2d3748;
        }

        .main-card {
            background: var(--pure-white);
            width: 100%; max-width: 480px;
            padding: 30px 20px; border-radius: 40px;
            box-shadow: 0 30px 60px var(--shadow-color);
            align-self: flex-start;
        }

        .brand-zone { text-align: center; margin-bottom: 20px; }
        .brand-logo { font-size: 32px; font-weight: 900; color: var(--main-blue); margin: 0; letter-spacing: -0.5px; }
        .brand-tagline { font-size: 14px; font-weight: 400; color: var(--accent-silver); letter-spacing: 5px; margin-top: 5px; }

        .form-group { margin-bottom: 15px; position: relative; }
        .form-label { font-size: 12px; font-weight: 900; margin-bottom: 6px; display: block; color: var(--main-blue); opacity: 0.7; }

        .input-box {
            width: 100%; padding: 15px 18px; padding-right: 80px; 
            border: 1px solid #edf2f7; border-radius: 18px; 
            font-size: 15px; background: #f8fafc; 
            color: #1a202c; box-sizing: border-box; transition: 0.3s;
        }
        .input-box:focus { border-color: var(--main-blue); outline: none; background: white; box-shadow: 0 0 0 4px rgba(0, 45, 94, 0.05); }

        .btn-location {
            position: absolute; right: 10px; bottom: 7px; padding: 8px 14px;
            background: var(--main-blue); color: white;
            border: none; border-radius: 12px; font-size: 12px; font-weight: 700; cursor: pointer;
        }

        /* é¸é …å€å¡Šæ¨£å¼ */
        .options-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;
        }
        .option-item {
            background: #f8fafc; padding: 12px; border-radius: 15px;
            display: flex; align-items: center; cursor: pointer;
            border: 1px solid #edf2f7; transition: 0.2s;
        }
        .option-item input { margin-right: 10px; width: 18px; height: 18px; cursor: pointer; }
        .option-item span { font-size: 13px; font-weight: 500; color: #4a5568; }
        .option-item:hover { border-color: var(--main-blue); }

        /* é€²å£è»Šå°ˆå±¬æ¨£å¼ */
        .option-full { grid-column: span 2; background: #fffbeb; border: 1px solid #fef3c7; }
        .option-full span { color: var(--gold); font-weight: 700; }

        #map {
            width: 100%; height: 300px; 
            border-radius: 25px; margin: 15px 0;
            background: #e2e8f0; border: 1px solid #edf2f7;
        }

        .btn-calculate {
            width: 100%; background: var(--main-blue);
            color: white; padding: 18px;
            font-size: 18px; font-weight: 700; border: none; border-radius: 20px; cursor: pointer;
            transition: 0.3s;
        }

        /* é”æ¨™æé†’ç”¨èª */
        #upgrade-alert {
            display: none; background: #fff4e5; color: #c2410c;
            padding: 12px; border-radius: 15px; margin-bottom: 15px;
            font-size: 13px; font-weight: 700; text-align: center;
            border: 1px dashed #fdba74;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        .result-panel {
            margin-top: 20px; padding: 25px; border-radius: 25px;
            background: #fdfdfd; border: 1px solid #edf2f7; 
            display: none; animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(15px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .price-text { font-size: 42px; font-weight: 900; color: var(--main-blue); margin: 5px 0; letter-spacing: -1px; }

        .final-disclaimer {
            margin-top: 15px; padding-top: 15px; border-top: 1px solid #f1f5f9;
            font-size: 12px; color: #94a3b8; line-height: 1.6; font-style: italic;
        }

        .btn-line {
            width: 100%; background: var(--line-green); color: white; padding: 16px;
            font-size: 17px; font-weight: 700; border: none; border-radius: 20px;
            margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer;
        }
    </style>
</head>
<body>

<div class="main-card">
    <div class="brand-zone">
        <h1 class="brand-logo">YiHaoCar</h1>
        <div class="brand-tagline">å°Šæ¦®åº§é§•æ´¾é£</div>
    </div>

    <div class="form-group">
        <label class="form-label">ğŸ’ å°Šæ¦®èµ·é»</label>
        <input type="text" id="start" class="input-box" placeholder="è¼¸å…¥åœ°å€æˆ–é»æ“Šå®šä½">
        <button class="btn-location" onclick="getCurrentLocation()">ğŸ“ å®šä½</button>
    </div>

    <div class="form-group">
        <label class="form-label">ğŸ° æŠµé”ç›®çš„åœ°</label>
        <input type="text" id="end" class="input-box" placeholder="è«‹è¼¸å…¥ç›®çš„åœ°">
    </div>

    <div class="options-grid">
        <label class="option-item">
            <input type="checkbox" id="avoidTolls"> <span>é¿é–‹æ”¶è²»è·¯æ®µ</span>
        </label>
        <label class="option-item">
            <input type="checkbox" id="avoidHighways"> <span>é¿é–‹é«˜é€Ÿå…¬è·¯</span>
        </label>
        <label class="option-item option-full">
            <input type="checkbox" id="premiumCar"> <span>æŒ‡å®šé€²å£è»Š (éš¨æ©Ÿè»Šæ¬¾)</span>
        </label>
    </div>

    <div id="map"></div>

    <div id="upgrade-alert">âœ¨ é ä¼°è»Šè³‡å·²é”æ¨™ï¼Œå‡ç´šé€²å£è»Šä¸åŠ åƒ¹ï¼</div>

    <button id="calc-btn" class="btn-calculate" onclick="calculateFare()">è¦åŠƒè¡Œç¨‹</button>

    <div id="result" class="result-panel">
        <div style="font-size:12px; color:var(--accent-silver); font-weight:700;">é ä¼°è¡Œç¨‹ç¸½é‡‘é¡</div>
        <div id="price-tag" class="price-text">$0</div>
        
        <div id="info-tag" style="font-size:14px; color:#4a5568; line-height:1.6; padding-top: 5px;"></div>

        <div class="final-disclaimer">
            â€» æ­¤é‡‘é¡ç‚ºç³»çµ±ä¾è·¯ç¨‹åˆæ­¥è©¦ç®—ï¼Œå¯¦éš›è¡Œç¨‹ç´°ç¯€å°‡ç”±å°ˆäººè¯ç¹«ç¢ºèªã€‚
        </div>

        <button class="btn-line" onclick="copyAndLine()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" width="20"> è¤‡è£½è³‡è¨Šä¸¦é ç´„
        </button>
    </div>
</div>

<script>
    let map, directionsService, directionsRenderer;
    let markerStart, markerEnd, autocompleteStart, autocompleteEnd;
    let currentTotal = 0;

    function initMap() {
        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer({
            polylineOptions: { strokeColor: "#002d5e", strokeWeight: 6 }
        });

        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 13, center: { lat: 24.1477, lng: 120.6736 },
            disableDefaultUI: true, zoomControl: true,
            styles: [{ "featureType": "poi", "stylers": [{ "visibility": "off" }] }]
        });
        directionsRenderer.setMap(map);

        markerStart = new google.maps.Marker({ map: map, visible: false, label: "èµ·" });
        markerEnd = new google.maps.Marker({ map: map, visible: false, label: "çµ‚" });

        const options = { componentRestrictions: { country: "tw" } };
        autocompleteStart = new google.maps.places.Autocomplete(document.getElementById('start'), options);
        autocompleteEnd = new google.maps.places.Autocomplete(document.getElementById('end'), options);

        autocompleteStart.addListener('place_changed', () => {
            const place = autocompleteStart.getPlace();
            if (place.geometry) updateMapFocus(place.geometry.location, 'start');
        });

        autocompleteEnd.addListener('place_changed', () => {
            const place = autocompleteEnd.getPlace();
            if (place.geometry) updateMapFocus(place.geometry.location, 'end');
        });
    }

    function updateMapFocus(latlng, type) {
        map.panTo(latlng);
        map.setZoom(16);
        if (type === 'start') { markerStart.setPosition(latlng); markerStart.setVisible(true); }
        else { markerEnd.setPosition(latlng); markerEnd.setVisible(true); }
    }

    function calculateFare() {
        const start = document.getElementById('start').value;
        const end = document.getElementById('end').value;
        if (!start || !end) return alert('è«‹å¡«å¯«å®Œæ•´åœ°é»è³‡è¨Š');

        // è·¯å¾‘åå¥½è¨­å®š
        const avoidTolls = document.getElementById('avoidTolls').checked;
        const avoidHighways = document.getElementById('avoidHighways').checked;

        directionsService.route({ 
            origin: start, 
            destination: end, 
            travelMode: 'DRIVING',
            avoidTolls: avoidTolls,
            avoidHighways: avoidHighways
        }, (result, status) => {
            if (status == 'OK') {
                markerStart.setVisible(false); markerEnd.setVisible(false);
                directionsRenderer.setDirections(result);
                
                const leg = result.routes[0].legs[0];
                const dist = leg.distance.value / 1000;
                const time = Math.ceil(leg.duration.value / 60);
                
                // è»Šè³‡è¨ˆç®—é‚è¼¯ (åŸºæœ¬è²» 80 + é‡Œç¨‹è²» + æ™‚é–“è²» + é•·é€”è£œè²¼)
                currentTotal = Math.round(80 + (dist * 15) + (time * 3) + (dist > 15 ? (dist-15)*10 : 0));

                document.getElementById('price-tag').innerText = `$${currentTotal.toLocaleString()}`;
                document.getElementById('info-tag').innerText = `âœ¨ é‡Œç¨‹ï¼š${dist.toFixed(1)} km | â³ è»Šç¨‹ï¼š${time} åˆ†é˜`;
                
                // 300å…ƒé–€æª»é‚è¼¯
                const alertBox = document.getElementById('upgrade-alert');
                const premiumCheckbox = document.getElementById('premiumCar');
                
                if (currentTotal >= 300 && !premiumCheckbox.checked) {
                    alertBox.style.display = 'block';
                } else {
                    alertBox.style.display = 'none';
                }

                document.getElementById('result').style.display = 'block';
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('ç„¡æ³•è¦åŠƒæ­¤è·¯ç·šï¼Œè«‹æª¢æŸ¥åå¥½è¨­å®šæˆ–åœ°å€æ˜¯å¦æ­£ç¢ºã€‚');
            }
        });
    }

    function getCurrentLocation() {
        if (!navigator.geolocation) return alert('ä¸æ”¯æ´å®šä½');
        navigator.geolocation.getCurrentPosition((pos) => {
            const coords = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            new google.maps.Geocoder().geocode({ location: coords }, (res, status) => {
                if (status === "OK") {
                    document.getElementById('start').value = res[0].formatted_address.replace('å°ç£', '').trim();
                    updateMapFocus(coords, 'start');
                }
            });
        }, null, { enableHighAccuracy: true });
    }

    function copyAndLine() {
        const isAvoidTolls = document.getElementById('avoidTolls').checked ? " [é¿é–‹æ”¶è²»]" : "";
        const isAvoidHigh = document.getElementById('avoidHighways').checked ? " [é¿é–‹é«˜é€Ÿ]" : "";
        const isPremium = document.getElementById('premiumCar').checked;
        
        let carTypeNote = isPremium ? "\nğŸŒŸ éœ€æ±‚ï¼šæŒ‡å®šé€²å£è»Š (å‡ç´šä¸åŠ åƒ¹)" : "";
        if (currentTotal >= 300 && !isPremium) {
            carTypeNote = "\nğŸ’¡ æé†’ï¼šé‡‘é¡å·²é”æ¨™ï¼Œå¯å…è²»å‡ç´šé€²å£è»Š (è«‹èˆ‡å®¢æœç¢ºèª)";
        }

        const msg = `ã€YiHaoCar å°Šæ¦®æ´¾é£é ç´„ã€‘
èµ·é»ï¼š${document.getElementById('start').value}
çµ‚é»ï¼š${document.getElementById('end').value}
è·¯å¾‘åå¥½ï¼šæ­£å¸¸è¡Œé§›${isAvoidTolls}${isAvoidHigh}
é ä¼°è»Šè³‡ï¼š${document.getElementById('price-tag').innerText}
è¡Œç¨‹æ˜ç´°ï¼š${document.getElementById('info-tag').innerText.replace(/\n/g, ' ')}${carTypeNote}
---
â€» æ­¤é‡‘é¡ç‚ºç³»çµ±åˆæ­¥è©¦ç®—ã€‚`;

        navigator.clipboard.writeText(msg).then(() => {
            alert('è¡Œç¨‹è³‡è¨Šå·²è¤‡è£½ï¼è«‹å‰å¾€ LINE è²¼ä¸Šé ç´„ã€‚');
            window.location.href = "https://lin.ee/o8sVnUW";
        });
    }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtgKupEUkOqUXV5bQMx_5PlXofFu-0vO4&libraries=places&callback=initMap&language=zh-TW" async defer></script>

</body>
</html>


