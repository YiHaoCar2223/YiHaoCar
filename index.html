<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YiHaoCar | å°Šæ¦®åº§é§•æ´¾é£ç³»çµ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-light: #f4f7f9;
            --main-blue: #002d5e;
            --accent-silver: #718096;
            --pure-white: #ffffff;
            --shadow-color: rgba(0, 45, 94, 0.08);
            --line-green: #06c755;
        }

        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-light); margin: 0; padding: 15px; color: #2d3748; }
        .main-card { background: var(--pure-white); width: 100%; max-width: 480px; padding: 30px 20px; border-radius: 40px; box-shadow: 0 30px 60px var(--shadow-color); margin: 0 auto; }
        .brand-zone { text-align: center; margin-bottom: 20px; }
        .brand-logo { font-size: 32px; font-weight: 900; color: var(--main-blue); margin: 0; }
        
        .form-group { margin-bottom: 15px; }
        .form-label { font-size: 11px; font-weight: 900; margin-bottom: 6px; display: block; color: var(--main-blue); opacity: 0.7; }
        .input-box { width: 100%; padding: 15px; border: 1px solid #edf2f7; border-radius: 18px; font-size: 15px; background: #f8fafc; box-sizing: border-box; }
        
        #booking-time-container { display: none; margin-top: 10px; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .option-item { background: #f8fafc; padding: 12px; border-radius: 15px; display: flex; align-items: center; cursor: pointer; border: 1px solid #edf2f7; }
        .option-item input { margin-right: 8px; width: 18px; height: 18px; }
        .option-full { grid-column: span 2; }

        #map { width: 100%; height: 260px; border-radius: 25px; margin: 15px 0; background: #e2e8f0; }
        .btn-calculate { width: 100%; background: var(--main-blue); color: white; padding: 18px; font-size: 18px; font-weight: 700; border: none; border-radius: 20px; cursor: pointer; }

        /* çµæœé¡¯ç¤º */
        .result-panel { margin-top: 20px; padding: 25px; border-radius: 30px; background: #ffffff; border: 2px solid var(--main-blue); display: none; }
        .detail-card { background: #f8fafc; padding: 15px; border-radius: 20px; margin: 15px 0; border: 1px solid #e2e8f0; }
        .detail-line { display: flex; justify-content: space-between; font-size: 14px; color: #4a5568; margin-bottom: 8px; }
        .detail-line b { color: #1a202c; font-weight: 700; }
        .highlight-line { color: var(--main-blue); font-weight: 900; border-bottom: 1px dashed #cbd5e1; padding-bottom: 5px; margin-bottom: 10px; }
        .total-row { border-top: 2px solid #cbd5e1; padding-top: 10px; margin-top: 10px; }
        .price-text { font-size: 42px; font-weight: 900; color: var(--main-blue); }

        .btn-line { width: 100%; background: var(--line-green); color: white; padding: 16px; font-size: 17px; font-weight: 700; border: none; border-radius: 20px; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; }
    </style>
</head>
<body>

<div class="main-card">
    <div class="brand-zone">
        <h1 class="brand-logo">YiHaoCar</h1>
    </div>

    <div class="form-group">
        <label class="form-label">èµ·é» Starting Point</label>
        <input type="text" id="start" class="input-box" placeholder="åœ°æ¨™ã€åº—åæˆ–åœ°å€">
    </div>

    <div class="form-group">
        <label class="form-label">çµ‚é» Destination</label>
        <input type="text" id="end" class="input-box" placeholder="è¼¸å…¥ç›®çš„åœ°">
    </div>

    <div class="options-grid">
        <label class="option-item option-full" style="background: #eef2ff;">
            <input type="checkbox" id="enableBooking" onchange="toggleBookingTime()"> 
            <span>ğŸ“… é ç´„è¡Œç¨‹ (è‡ªè¨‚æ™‚é–“)</span>
        </label>
        <div id="booking-time-container" class="form-group option-full">
            <input type="datetime-local" id="pickupTime" class="input-box">
        </div>
        
        <label class="option-item"><input type="checkbox" id="avoidTolls"> <span>é¿é–‹éè·¯è²»</span></label>
        <label class="option-item"><input type="checkbox" id="avoidHighways"> <span>é¿é–‹é«˜é€Ÿ</span></label>
    </div>

    <div id="map"></div>
    <button id="calc-btn" class="btn-calculate" onclick="calculateFare()">é–‹å§‹è©¦ç®—è²»ç”¨</button>

    <div id="result" class="result-panel">
        <div class="detail-card">
            <div class="detail-line highlight-line"><span>ç¸½è¡Œç¨‹é‡Œç¨‹</span><b id="res-dist">- km</b></div>
            <div class="detail-line highlight-line"><span>é ä¼°è¡Œè»Šæ™‚é–“</span><b id="res-time">- min</b></div>
            
            <div class="detail-line"><span>åŸºæœ¬é‡Œç¨‹è²» ($15/km)</span><b id="dist-fee">$0</b></div>
            <div class="detail-line" style="color:#e53e3e;"><span>é•·é€”é™„åŠ è²» (é€¾15km)</span><b id="long-fee">$0</b></div>
            <div class="detail-line"><span>è¡Œè»Šæ™‚é–“è²» ($3/min)</span><b id="time-fee">$0</b></div>
            <div class="detail-line"><span>èµ·æ­¥åƒ¹</span><b>$100</b></div>
            
            <div class="detail-line total-row">
                <span style="font-weight:900; color:var(--main-blue);">ç¸½é ä¼°é‡‘é¡ (å»å°¾æ•¸)</span>
                <span id="price-tag" class="price-text">$0</span>
            </div>
        </div>
        
        <button class="btn-line" onclick="copyAndLine()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" width="20"> è¤‡è£½è³‡è¨Šä¸¦å‰å¾€ LINE
        </button>
    </div>
</div>

<script>
    let map, directionsService, directionsRenderer;
    let autocompleteStart, autocompleteEnd;
    let currentTotal = 0;
    let finalDist = 0;
    let finalTime = 0;

    function toggleBookingTime() {
        document.getElementById('booking-time-container').style.display = document.getElementById('enableBooking').checked ? 'block' : 'none';
    }

    function initMap() {
        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer({ polylineOptions: { strokeColor: "#002d5e", strokeWeight: 6 } });
        map = new google.maps.Map(document.getElementById("map"), { zoom: 13, center: { lat: 24.1477, lng: 120.6736 }, disableDefaultUI: true });
        directionsRenderer.setMap(map);

        // ğŸš€ ä¿®æ”¹é»ï¼šç§»é™¤ types é™åˆ¶ï¼Œå…è¨±æœå°‹åœ°æ¨™
        const options = { componentRestrictions: { country: "tw" }, fields: ["geometry", "formatted_address", "name"] };
        autocompleteStart = new google.maps.places.Autocomplete(document.getElementById('start'), options);
        autocompleteEnd = new google.maps.places.Autocomplete(document.getElementById('end'), options);
    }

    function calculateFare() {
        const start = document.getElementById('start').value;
        const end = document.getElementById('end').value;
        if (!start || !end) return alert('è«‹è¼¸å…¥å®Œæ•´èµ·é»èˆ‡çµ‚é»åœ°å€');

        directionsService.route({
            origin: start,
            destination: end,
            travelMode: 'DRIVING',
            avoidTolls: document.getElementById('avoidTolls').checked,
            avoidHighways: document.getElementById('avoidHighways').checked
        }, (result, status) => {
            if (status === 'OK') {
                directionsRenderer.setDirections(result);
                const leg = result.routes[0].legs[0];
                
                // ğŸš€ æ­£ç¢ºæŠ“å–å…¬é‡Œæ•¸èˆ‡æ™‚é–“
                finalDist = leg.distance.value / 1000; // å…¬é‡Œ
                finalTime = Math.ceil(leg.duration.value / 60); // åˆ†é˜

                // é‚è¼¯è¨ˆç®—
                let baseDistFee = Math.round(finalDist * 15);
                
                // ğŸš€ é•·é€”é™„åŠ é‚è¼¯ä¿®æ­£ï¼šè¶…é 15km çš„éƒ¨åˆ†æ¯å…¬é‡ŒåŠ  10 å…ƒ
                let longDistFee = 0;
                if (finalDist > 15) {
                    longDistFee = Math.round((finalDist - 15) * 10);
                }

                let timeFee = finalTime * 3;
                let startFee = 100;

                // ç¸½é‡‘é¡èˆ‡å»å°¾æ•¸
                let rawTotal = baseDistFee + longDistFee + timeFee + startFee;
                currentTotal = Math.floor(rawTotal / 10) * 10;

                // æ›´æ–°ä»‹é¢
                document.getElementById('res-dist').innerText = finalDist.toFixed(1) + " km";
                document.getElementById('res-time').innerText = finalTime + " åˆ†é˜";
                document.getElementById('dist-fee').innerText = "$" + baseDistFee;
                document.getElementById('long-fee').innerText = "$" + longDistFee;
                document.getElementById('time-fee').innerText = "$" + timeFee;
                document.getElementById('price-tag').innerText = "$" + currentTotal;

                document.getElementById('result').style.display = 'block';
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('ç„¡æ³•è¦åŠƒè·¯å¾‘ï¼Œè«‹ç¢ºèªåœ°å€æ˜¯å¦ç²¾ç¢ºã€‚');
            }
        });
    }

    function copyAndLine() {
        const isBooking = document.getElementById('enableBooking').checked;
        const bookingTime = isBooking ? document.getElementById('pickupTime').value.replace('T', ' ') : "å³æ™‚å‡ºç™¼";
        const msg = `ã€YiHaoCar é ç´„è¡Œç¨‹ã€‘\né ç´„æ™‚é–“ï¼š${bookingTime}\nèµ·é»ï¼š${document.getElementById('start').value}\nçµ‚é»ï¼š${document.getElementById('end').value}\né‡Œç¨‹ï¼š${finalDist.toFixed(1)} km\næ™‚é–“ï¼š${finalTime} min\né ä¼°é‡‘é¡ï¼š$${currentTotal}\n---\nç³»çµ±è‡ªå‹•è©¦ç®—ï¼Œå¯¦éš›ä¾å¸æ©Ÿç«¯ç‚ºä¸»ã€‚`;
        
        navigator.clipboard.writeText(msg).then(() => {
            alert('è¡Œç¨‹è³‡è¨Šå·²è¤‡è£½ï¼');
            window.location.href = "https://lin.ee/o8sVnUW";
        });
    }
</script>

<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtgKupEUkOqUXV5bQMx_5PlXofFu-0vO4&libraries=places&callback=initMap&language=zh-TW"></script>

</body>
</html>
